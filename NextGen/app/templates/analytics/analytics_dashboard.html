{% extends "dashboard.html" %}
{% block content %}

<div style="padding: 20px; width: 100%; max-width: 1500px; margin: auto;">

    <h1>Analytics</h1>
    <p>Track performance and gain business insights</p>

    <!-- GRID -->
    <div style="
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 35px;
        margin-top: 30px;
        align-items: stretch;
    ">

        <!-- Revenue Chart -->
        <div style="
            background:#1a1e2e;
            padding:30px;
            border-radius:18px;
            height: 380px;
            display:flex;
            flex-direction:column;
        ">
            <h3 style="margin-bottom:15px;">ðŸ“‰ Revenue & Profit Trends</h3>
            <div style="flex:1;">
                <canvas id="revChart"></canvas>
            </div>
        </div>

        <!-- Category Chart -->
        <div style="
            background:#1a1e2e;
            padding:30px;
            border-radius:18px;
            height: 380px;
            display:flex;
            flex-direction:column;
        ">
            <h3 style="margin-bottom:15px;">ðŸ›’ Sales by Category</h3>
            <div style="flex:1; display:flex; justify-content:center; align-items:center;">
                <canvas id="catChart" style="max-width:320px;"></canvas>
            </div>
        </div>

    </div>
</div>

<!-- All Products Table -->
    <div style="margin-top:35px; background:#1a1e2e; padding:25px; border-radius:16px;">
        <h3 style="margin-bottom:15px; color:white;">All Products (including zero sales)</h3>

        <div style="max-height:350px; overflow-y:scroll;">
            <table style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr style="color:#cbd5e1; text-align:left; font-size:17px;">
                        <th style="padding:10px 12px;">ID</th>
                        <th style="padding:10px 12px;">Name</th>
                        <th style="padding:10px 12px;">Category</th>
                        <th style="padding:10px 12px;">Sold Qty</th>
                        <th style="padding:10px 12px;">Stock</th>
                    </tr>
                </thead>

                <tbody style="color:#e6eef8; font-size:16px;">
                    {% for p in product_sales %}
                    <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
                        <td style="padding:10px 12px;">{{ p.id }}</td>
                        <td style="padding:10px 12px;">{{ p.name }}</td>
                        <td style="padding:10px 12px;">{{ p.category }}</td>
                        <td style="padding:10px 12px;">{{ p.total_qty }}</td>
                        <td style="padding:10px 12px;">{{ p.stock_qty }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const rpData = {{ revenue_profit | tojson }};
    const catData = {{ category_sales | tojson }};

    /* ---------------- Revenue Chart ---------------- */
    new Chart(document.getElementById("revChart"), {
        type: "line",
        data: {
            labels: rpData.map(x => x[0]),
            datasets: [
                {
                    label: "Revenue (â‚¹)",
                    data: rpData.map(x => x[1]),
                    borderColor:"#4ea3ff",
                    borderWidth: 2,
                    pointRadius: 4,
                    tension:0.3
                },
                {
                    label: "Profit (â‚¹)",
                    data: rpData.map(x => x[2]),
                    borderColor:"#ff7995",
                    borderWidth: 2,
                    pointRadius: 4,
                    tension:0.3
                }
            ]
        },
        options: {
            responsive:true,
            maintainAspectRatio:false,
            plugins:{ legend:{ position:"top" }},
            scales:{ y:{ beginAtZero:true }}
        }
    });

    /* ---------------- Category Chart ---------------- */
    new Chart(document.getElementById("catChart"), {
        type:"pie",
        data:{
            labels: catData.map(x => x[0]),
            datasets:[{
                data: catData.map(x => x[1])
            }]
        },
        options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
                legend:{
                    position:"right",
                    labels:{ boxWidth:14 }
                }
            }
        }
    });
</script>

{% endblock %}
