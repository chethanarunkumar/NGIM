{% extends "dashboard.html" %}
{% block content %}

<style>
  .pos-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
  }
  .pos-box {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
      width: 50%;
      color: white;
  }
  .pos-input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.08);
      color: white;
      margin-bottom: 12px;
  }
  table th, table td {
      padding: 10px;
      text-align: left;
  }
  .checkout-btn {
      background: #1565C0;
      padding: 12px 18px;
      border-radius: 8px;
      border: none;
      color: white;
      margin-top: 10px;
      cursor: pointer;
      font-weight: bold;
  }
</style>

<script>
   window.__INITIAL_PRODUCTS = {{ products | tojson }};
</script>

<h2 style="color:white; font-size:30px;">Billing Panel</h2>

<div class="pos-container">

    <!-- LEFT SIDE: PRODUCT SEARCH -->
    <div class="pos-box">
        <input id="searchBox" class="pos-input" placeholder="Search product...">

        <div id="resultBox" style="max-height: 420px; overflow-y:auto;"></div>
    </div>

    <!-- RIGHT SIDE: CART -->
    <div class="pos-box">
        <table style="width:100%;">
            <thead>
                <tr style="color:#ddd;">
                    <th>Name</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="billBody"></tbody>
        </table>

        <h2 style="margin-top:20px;">Total: â‚¹<span id="net">0</span></h2>

        <button id="checkoutBtn" class="checkout-btn">Checkout</button>
    </div>

</div>


<!-- ========= RECENT BILLS ============= -->
<div id="billHistoryWrap" style="margin-top:30px;">
  <h3 style="color:white; margin-bottom:12px;">Recent Bills</h3>
  <div id="billHistory" style="background: rgba(255,255,255,0.03); padding:12px; border-radius:10px;">
    <div style="color:#cfe3ff; padding:10px;">Loading bills...</div>
  </div>
</div>


<!-- IMPORTANT: Correct Billing URLs for JS -->
<script>
window.BILLING_URLS = {
    search: "/dashboard/products/billing/search",
    checkout: "/dashboard/products/billing/checkout",
    history: "/dashboard/products/billing/history",
    print: (bno) => `/dashboard/products/billing/print/${bno}`,
    pdf: (bno) => `/dashboard/products/billing/pdf/${bno}`
};
</script>

<script src="{{ url_for('static', filename='js/billing.js') }}"></script>

{% endblock %}
